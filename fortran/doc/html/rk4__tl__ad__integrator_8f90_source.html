<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>rk4_tl_ad_integrator.f90 Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="MAOOAM_small.png"/></td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">A Modular Arbitrary-Order Ocean-Atmosphere Model</div>
    </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">rk4_tl_ad_integrator.f90</div>  </div>
</div><!--header-->
<div class="contents">
<a href="rk4__tl__ad__integrator_8f90.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">! tl_ad_integrator.f90</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">!</span><span class="comment"></span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">!&gt; Tangent Linear (TL) and Adjoint (AD) model versions of MAOOAM.</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">!&gt; Integrators module.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">!</span><span class="comment"></span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">!&gt; @copyright                                                               </span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">!&gt; 2016 Lesley De Cruz, Jonathan Demaeyer &amp; Sebastian Schubert.</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">!&gt; See LICENSE.txt for license information.                                  </span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">!</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">!---------------------------------------------------------------------------!</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">!                                                                           </span><span class="comment"></span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">!&gt;  @remark                                                                 </span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">!&gt;  This module actually contains the RK4 algorithm routines.</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">!&gt;  The user can modify it according to its preferred integration scheme.</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">!&gt;  For higher-order schemes, additional bufers will probably have to be defined.</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">!                                                                           </span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">!---------------------------------------------------------------------------</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">MODULE</span> <a class="code" href="namespacetl__ad__integrator.html">tl_ad_integrator</a></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  <span class="keywordtype">USE </span><a class="code" href="namespaceutil.html">util</a><span class="keywordtype">, only</span>: <a class="code" href="namespaceutil.html#aca7f2465fedb87fef954d8f0c30668c7">init_one</a></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;  <span class="keywordtype">USE </span><a class="code" href="namespaceparams.html">params</a><span class="keywordtype">, only</span>: <a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;  <span class="keywordtype">USE </span><a class="code" href="namespacetensor.html">tensor</a><span class="keywordtype">, only</span>: <a class="code" href="namespacetensor.html#a11054027a386918658f8948231af53b1">sparse_mul3</a></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;  <span class="keywordtype">USE </span><a class="code" href="namespaceaotensor__def.html">aotensor_def</a><span class="keywordtype">, only</span>: <a class="code" href="namespaceaotensor__def.html#a0dc43bc9294a18f2fe57b67489f1702f">aotensor</a></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <span class="keywordtype">USE </span><a class="code" href="namespacetl__ad__tensor.html">tl_ad_tensor</a> <span class="keywordtype">, only</span>: <a class="code" href="namespacetl__ad__tensor.html#af4683da4f4149b809eb66c3223266ffd">ad</a>,<a class="code" href="namespacetl__ad__tensor.html#a2a6bcaa9d4e82c35f6bfb2fdb9016dd9">tl</a>,<a class="code" href="namespacetl__ad__tensor.html#a2782a5116e8bb677b2d5e9637b509cf3">jacobian_mat</a></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  <span class="keywordtype">IMPLICIT NONE</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <span class="keywordtype">PRIVATE</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: <a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a><span class="comment"> !&lt; Buffer to hold the intermediate position of the tangent linear model</span></div><div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">   35</a></span>&#160;  <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a><span class="comment"> !&lt; Buffer to hold tendencies in the RK4 scheme for the tangent linear model</span></div><div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">   36</a></span>&#160;  <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: <a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a><span class="comment"> !&lt; Buffer to hold tendencies in the RK4 scheme for the tangent linear model</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;  <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: <a class="code" href="namespacetl__ad__integrator.html#ae17c25e2843c5f18b69c133ccca1d483">buf_y11</a><span class="comment"> !&lt; Buffer to hold the intermediate position of the tangent linear model</span></div><div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="namespacetl__ad__integrator.html#a1cf59efa7229b47e580202dfe4bd4fd6">   38</a></span>&#160;  <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: <a class="code" href="namespacetl__ad__integrator.html#a1cf59efa7229b47e580202dfe4bd4fd6">buf_kc</a><span class="comment"> !&lt; Buffer to hold tendencies in the RK4 scheme for the tangent linear model</span></div><div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="namespacetl__ad__integrator.html#a3b72ebc24a7e0eb44e22e6489ac81ed3">   39</a></span>&#160;  <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: <a class="code" href="namespacetl__ad__integrator.html#a3b72ebc24a7e0eb44e22e6489ac81ed3">buf_kd</a><span class="comment"> !&lt; Buffer to hold tendencies in the RK4 scheme for the tangent linear model</span></div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(:,:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: <a class="code" href="namespacetl__ad__integrator.html#abf7d3c46036ca20cca151adc20a2fa14">buf_j1</a><span class="comment"> !&lt; Buffer to hold jacobians in the RK4 scheme for the tangent linear model</span></div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(:,:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: <a class="code" href="namespacetl__ad__integrator.html#a0ce53a275fcb35f76e2b34ee8d8df1ca">buf_j2</a><span class="comment"> !&lt; Buffer to hold jacobians in the RK4 scheme for the tangent linear model</span></div><div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="namespacetl__ad__integrator.html#afb500987b643ce33b2a549ba213221fc">   42</a></span>&#160;  <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(:,:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: <a class="code" href="namespacetl__ad__integrator.html#afb500987b643ce33b2a549ba213221fc">buf_j3</a><span class="comment"> !&lt; Buffer to hold jacobians in the RK4 scheme for the tangent linear model</span></div><div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="namespacetl__ad__integrator.html#a853bee458e7337f1556f19370dcbc9d6">   43</a></span>&#160;  <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(:,:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: <a class="code" href="namespacetl__ad__integrator.html#a853bee458e7337f1556f19370dcbc9d6">buf_j4</a><span class="comment"> !&lt; Buffer to hold jacobians in the RK4 scheme for the tangent linear model</span></div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(:,:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: <a class="code" href="namespacetl__ad__integrator.html#a4ae89c821542838ecfc5ac3b7a76d5c1">buf_j1h</a><span class="comment"> !&lt; Buffer to hold jacobians in the RK4 scheme for the tangent linear model</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;  <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(:,:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: <a class="code" href="namespacetl__ad__integrator.html#a2a5e4cbc6f573f1274e53cbb4607f5bb">buf_j2h</a><span class="comment"> !&lt; Buffer to hold jacobians in the RK4 scheme for the tangent linear model</span></div><div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="namespacetl__ad__integrator.html#a9ead2c02f871be0e94e91278fa71337c">   46</a></span>&#160;  <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(:,:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: <a class="code" href="namespacetl__ad__integrator.html#a9ead2c02f871be0e94e91278fa71337c">buf_j3h</a><span class="comment"> !&lt; Buffer to hold jacobians in the RK4 scheme for the tangent linear model</span></div><div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="namespacetl__ad__integrator.html#a99c2747c1997b622f4ab6170e3a8f23d">   47</a></span>&#160;  <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(:,:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: <a class="code" href="namespacetl__ad__integrator.html#a99c2747c1997b622f4ab6170e3a8f23d">buf_j4h</a><span class="comment"> !&lt; Buffer to hold jacobians in the RK4 scheme for the tangent linear model</span></div><div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">   48</a></span>&#160;  <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: <a class="code" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">buf_kaa</a><span class="comment"> !&lt; Buffer to hold tendencies in the RK4 scheme for the tangent linear model</span></div><div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="namespacetl__ad__integrator.html#a68ad95731421a7e0c9f37668631e279c">   49</a></span>&#160;  <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: <a class="code" href="namespacetl__ad__integrator.html#a68ad95731421a7e0c9f37668631e279c">buf_kbb</a><span class="comment"> !&lt; Buffer to hold tendencies in the RK4 scheme for the tangent linear model</span></div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(:,:)</span>, <span class="keywordtype">ALLOCATABLE</span> :: <a class="code" href="namespacetl__ad__integrator.html#a08f375467a942d0ad466b407a8007a7e">one</a><span class="comment">        !&lt; unit matrix </span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    </div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  <span class="keywordtype">PUBLIC</span> :: <a class="code" href="namespacetl__ad__integrator.html#a708ece5eac01486e65e889d19073fd19">ad_step</a>, <a class="code" href="namespacetl__ad__integrator.html#aeef5ff45fe5f9b73ceb8d72c195dc381">init_tl_ad_integrator</a>, <a class="code" href="namespacetl__ad__integrator.html#ac88b155557d4fc0bae70007fde3aef06">tl_step</a>, <a class="code" href="namespacetl__ad__integrator.html#abc53f72486953af9fa4ced620eee226f">evolve_ad_step</a>, <a class="code" href="namespacetl__ad__integrator.html#a9fb60b4a88b0c5d6ca27b58440a32f74">evolve_tl_step</a>, <a class="code" href="namespacetl__ad__integrator.html#a76538a8bd594899e94228abaa34b48cd">prop_step</a></div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="keyword">CONTAINS</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">  !&gt; Routine computing the tendencies of the nonlinear model</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">  !&gt; @param t Time at which the tendencies have to be computed. Actually not needed for autonomous systems.</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">  !&gt; @param y Point at which the tendencies have to be computed.</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">  !&gt; @param res vector to store the result.</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">  !&gt; @remark Note that it is NOT safe to pass `y` as a result bufer, </span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">  !&gt; as this operation does multiple passes.</span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="keyword">  SUBROUTINE </span><a class="code" href="namespacetl__ad__integrator.html#aa03be9677761cfa373b15c85cccdc424">tendencies</a>(t,y,res)</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">INTENT(IN)</span> :: t</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(0:ndim)</span>, <span class="keywordtype">INTENT(IN)</span> :: y</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(0:ndim)</span>, <span class="keywordtype">INTENT(OUT)</span> :: res</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetensor.html#a11054027a386918658f8948231af53b1">sparse_mul3</a>(<a class="code" href="namespaceaotensor__def.html#a0dc43bc9294a18f2fe57b67489f1702f">aotensor</a>, y, y, res)</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="keyword">  END SUBROUTINE </span><a class="code" href="namespacetl__ad__integrator.html#aa03be9677761cfa373b15c85cccdc424">tendencies</a></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">  !&gt; Routine to initialise the TL-AD integration bufers.</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="keyword">  SUBROUTINE </span><a class="code" href="namespacetl__ad__integrator.html#aeef5ff45fe5f9b73ceb8d72c195dc381">init_tl_ad_integrator</a></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordtype">INTEGER</span> :: allocstat</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    <span class="keyword">ALLOCATE</span>(<a class="code" href="namespacetl__ad__integrator.html#a4ae89c821542838ecfc5ac3b7a76d5c1">buf_j1h</a>(<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>,<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>),<a class="code" href="namespacetl__ad__integrator.html#a2a5e4cbc6f573f1274e53cbb4607f5bb">buf_j2h</a>(<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>,<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>),<a class="code" href="namespacetl__ad__integrator.html#a9ead2c02f871be0e94e91278fa71337c">buf_j3h</a>(<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>,<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>),&amp;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;         &amp;<a class="code" href="namespacetl__ad__integrator.html#a99c2747c1997b622f4ab6170e3a8f23d">buf_j4h</a>(<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>,<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>),<a class="code" href="namespacetl__ad__integrator.html#abf7d3c46036ca20cca151adc20a2fa14">buf_j1</a>(<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>,<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>),<a class="code" href="namespacetl__ad__integrator.html#a0ce53a275fcb35f76e2b34ee8d8df1ca">buf_j2</a>(<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>,<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>),&amp;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;         &amp;<a class="code" href="namespacetl__ad__integrator.html#afb500987b643ce33b2a549ba213221fc">buf_j3</a>(<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>,<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>),<a class="code" href="namespacetl__ad__integrator.html#a853bee458e7337f1556f19370dcbc9d6">buf_j4</a>(<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>,<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>),<a class="code" href="namespacetl__ad__integrator.html#a08f375467a942d0ad466b407a8007a7e">one</a>(<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>,<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>),<a class="code" href="namespacetl__ad__integrator.html#ae17c25e2843c5f18b69c133ccca1d483">buf_y11</a>(0:<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>),&amp;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;         &amp;<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>(0:<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>),<a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a>(0:<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>),<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a>(0:<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>),<a class="code" href="namespacetl__ad__integrator.html#a1cf59efa7229b47e580202dfe4bd4fd6">buf_kc</a>(0:<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>),<a class="code" href="namespacetl__ad__integrator.html#a3b72ebc24a7e0eb44e22e6489ac81ed3">buf_kd</a>(0:<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>), &amp;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;         &amp;<a class="code" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">buf_kaa</a>(0:<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>),<a class="code" href="namespacetl__ad__integrator.html#a68ad95731421a7e0c9f37668631e279c">buf_kbb</a>(0:<a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>) ,<a class="code" href="namespacestat.html">stat</a>=allocstat)</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">IF</span> (allocstat /= 0) stop <span class="stringliteral">&quot;*** Not enough memory ! ***&quot;</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespaceutil.html#aca7f2465fedb87fef954d8f0c30668c7">init_one</a>(<a class="code" href="namespacetl__ad__integrator.html#a08f375467a942d0ad466b407a8007a7e">one</a>)</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="keyword">  END SUBROUTINE </span><a class="code" href="namespacetl__ad__integrator.html#aeef5ff45fe5f9b73ceb8d72c195dc381">init_tl_ad_integrator</a></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="comment">!-----------------------------------------------------!</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  <span class="comment">!                                                     !</span></div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="comment">! Adjoint model integrator                            !</span></div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  <span class="comment">!                                                     !</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="comment">!-----------------------------------------------------!</span></div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;  </div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">  !&gt; Routine to perform an integration step (RK4 algorithm) of the adjoint model. The incremented time is returned.</span></div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="comment">  !&gt; @param y Initial point.</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">  !&gt; @param ystar Adjoint model at the point ystar.</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">  !&gt; @param t Actual integration time</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">  !&gt; @param dt Integration timestep.</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">  !&gt; @param res Final point after the step.</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="keyword">  SUBROUTINE </span><a class="code" href="namespacetl__ad__integrator.html#a708ece5eac01486e65e889d19073fd19">ad_step</a>(y,ystar,t,dt,res)</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(0:ndim)</span>, <span class="keywordtype">INTENT(IN)</span> :: y,ystar</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">INTENT(INOUT)</span> :: t</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">INTENT(IN)</span> :: dt</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(0:ndim)</span>, <span class="keywordtype">INTENT(OUT)</span> :: res</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__tensor.html#af4683da4f4149b809eb66c3223266ffd">ad</a>(t,ystar,y,<a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a>)</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a> = y+0.5*dt*<a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__tensor.html#af4683da4f4149b809eb66c3223266ffd">ad</a>(t+0.5*dt,ystar,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a>)</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a> = y+0.5*dt*<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a> = <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a>+2*<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__tensor.html#af4683da4f4149b809eb66c3223266ffd">ad</a>(t+0.5*dt,ystar,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a>)</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a> = y+0.5*dt*<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a> = <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a>+2*<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__tensor.html#af4683da4f4149b809eb66c3223266ffd">ad</a>(t+dt,ystar,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a>)</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a> = <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a>+<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    res=y+<a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a>*dt/6</div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;    t=t+dt</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="keyword">  END SUBROUTINE </span><a class="code" href="namespacetl__ad__integrator.html#a708ece5eac01486e65e889d19073fd19">ad_step</a></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">  !&gt; Routine to perform a simultaneous integration step (RK4 algorithm) of the nonlinear and adjoint model together. The incremented time is returned.</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">  !&gt; @param y Model variable at time t</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">  !&gt; @param deltay Perturbation at time t</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">  !&gt; @param t Actual integration time</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">  !&gt; @param dt Integration timestep.</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">  !&gt; @param ynew Model variable at time t+dt</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">  !&gt; @param deltaynew Perturbation at time t+dt</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="keyword">  SUBROUTINE </span><a class="code" href="namespacetl__ad__integrator.html#abc53f72486953af9fa4ced620eee226f">evolve_ad_step</a>(y,deltay,t,dt,ynew,deltaynew)</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(0:ndim)</span>, <span class="keywordtype">INTENT(IN)</span> :: y,deltay</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">INTENT(INOUT)</span> :: t</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">INTENT(IN)</span> :: dt</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(0:ndim)</span>, <span class="keywordtype">INTENT(OUT)</span> :: ynew,deltaynew</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__integrator.html#aa03be9677761cfa373b15c85cccdc424">tendencies</a>(t,y,<a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a>)</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__tensor.html#af4683da4f4149b809eb66c3223266ffd">ad</a>(t,y,deltay,<a class="code" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">buf_kaa</a>)</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a> = y + 0.5*dt*<a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#ae17c25e2843c5f18b69c133ccca1d483">buf_y11</a> = deltay + 0.5*dt*<a class="code" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">buf_kaa</a></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__integrator.html#aa03be9677761cfa373b15c85cccdc424">tendencies</a>(t+0.5*dt,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a>)</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__tensor.html#af4683da4f4149b809eb66c3223266ffd">ad</a>(t+0.5*dt,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#ae17c25e2843c5f18b69c133ccca1d483">buf_y11</a>,<a class="code" href="namespacetl__ad__integrator.html#a68ad95731421a7e0c9f37668631e279c">buf_kbb</a>)</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    </div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a> = y + 0.5*dt*<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#ae17c25e2843c5f18b69c133ccca1d483">buf_y11</a> = deltay + 0.5*dt*<a class="code" href="namespacetl__ad__integrator.html#a68ad95731421a7e0c9f37668631e279c">buf_kbb</a></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a> = <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a> + 2*<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">buf_kaa</a> = <a class="code" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">buf_kaa</a> + 2*<a class="code" href="namespacetl__ad__integrator.html#a68ad95731421a7e0c9f37668631e279c">buf_kbb</a></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    </div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__integrator.html#aa03be9677761cfa373b15c85cccdc424">tendencies</a>(t+0.5*dt,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a>)</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__tensor.html#af4683da4f4149b809eb66c3223266ffd">ad</a>(t+0.5*dt,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#ae17c25e2843c5f18b69c133ccca1d483">buf_y11</a>,<a class="code" href="namespacetl__ad__integrator.html#a68ad95731421a7e0c9f37668631e279c">buf_kbb</a>)</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    </div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a> = y + dt*<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#ae17c25e2843c5f18b69c133ccca1d483">buf_y11</a> = deltay + dt*<a class="code" href="namespacetl__ad__integrator.html#a68ad95731421a7e0c9f37668631e279c">buf_kbb</a></div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    </div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a> = <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a> + 2*<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">buf_kaa</a> = <a class="code" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">buf_kaa</a> + 2*<a class="code" href="namespacetl__ad__integrator.html#a68ad95731421a7e0c9f37668631e279c">buf_kbb</a></div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    </div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__integrator.html#aa03be9677761cfa373b15c85cccdc424">tendencies</a>(t+dt,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a>)</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__tensor.html#af4683da4f4149b809eb66c3223266ffd">ad</a>(t+dt,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#ae17c25e2843c5f18b69c133ccca1d483">buf_y11</a>,<a class="code" href="namespacetl__ad__integrator.html#a68ad95731421a7e0c9f37668631e279c">buf_kbb</a>)</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a> = <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a> + <a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">buf_kaa</a> = <a class="code" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">buf_kaa</a> + <a class="code" href="namespacetl__ad__integrator.html#a68ad95731421a7e0c9f37668631e279c">buf_kbb</a></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    </div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    t=t+dt</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    ynew=y+<a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a>*dt/6</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    deltaynew=deltay+<a class="code" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">buf_kaa</a>*dt/6</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="keyword">  END SUBROUTINE </span><a class="code" href="namespacetl__ad__integrator.html#abc53f72486953af9fa4ced620eee226f">evolve_ad_step</a></div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  <span class="comment">!-----------------------------------------------------!</span></div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="comment">!                                                     !</span></div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="comment">! Tangent linear model integrator                     !</span></div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="comment">!                                                     !</span></div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;  <span class="comment">!-----------------------------------------------------!</span></div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="comment">  !&gt; Routine to perform an integration step (RK4 algorithm) of the tangent linear model. The incremented time is returned.</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;<span class="comment">  !&gt; @param y Initial point.</span></div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;<span class="comment">  !&gt; @param ystar Adjoint model at the point ystar.</span></div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;<span class="comment">  !&gt; @param t Actual integration time</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="comment">  !&gt; @param dt Integration timestep.</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">  !&gt; @param res Final point after the step.</span></div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;<span class="keyword">  SUBROUTINE </span><a class="code" href="namespacetl__ad__integrator.html#ac88b155557d4fc0bae70007fde3aef06">tl_step</a>(y,ystar,t,dt,res)</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(0:ndim)</span>, <span class="keywordtype">INTENT(IN)</span> :: y,ystar</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">INTENT(INOUT)</span> :: t</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">INTENT(IN)</span> :: dt</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(0:ndim)</span>, <span class="keywordtype">INTENT(OUT)</span> :: res</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__tensor.html#a2a6bcaa9d4e82c35f6bfb2fdb9016dd9">tl</a>(t,ystar,y,<a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a>)</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a> = y+0.5*dt*<a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a></div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__tensor.html#a2a6bcaa9d4e82c35f6bfb2fdb9016dd9">tl</a>(t+0.5*dt,ystar,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a>)</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a> = y+0.5*dt*<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a> = <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a>+2*<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__tensor.html#a2a6bcaa9d4e82c35f6bfb2fdb9016dd9">tl</a>(t+0.5*dt,ystar,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a>)</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a> = y+0.5*dt*<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a> = <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a>+2*<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__tensor.html#a2a6bcaa9d4e82c35f6bfb2fdb9016dd9">tl</a>(t+dt,ystar,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a>)</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a> = <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a>+<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    res=y+<a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a>*dt/6</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    t=t+dt</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="keyword">  END SUBROUTINE </span><a class="code" href="namespacetl__ad__integrator.html#ac88b155557d4fc0bae70007fde3aef06">tl_step</a></div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">  !&gt; Routine to perform a simultaneous integration step (RK4 algorithm) of the nonlinear and tangent linear model togheter. The incremented time is returned.</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">  !&gt; @param y Model variable at time t</span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">  !&gt; @param deltay Perturbation at time t</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">  !&gt; @param t Actual integration time</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">  !&gt; @param dt Integration timestep.</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">  !&gt; @param ynew Model variable at time t+dt</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">  !&gt; @param deltaynew Perturbation at time t+dt</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="keyword">  SUBROUTINE </span><a class="code" href="namespacetl__ad__integrator.html#a9fb60b4a88b0c5d6ca27b58440a32f74">evolve_tl_step</a>(y,deltay,t,dt,ynew,deltaynew)</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(0:ndim)</span>, <span class="keywordtype">INTENT(IN)</span> :: y,deltay</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">INTENT(INOUT)</span> :: t</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">INTENT(IN)</span> :: dt</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(0:ndim)</span>, <span class="keywordtype">INTENT(OUT)</span> :: ynew,deltaynew</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__integrator.html#aa03be9677761cfa373b15c85cccdc424">tendencies</a>(t,y,<a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a>)</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__tensor.html#a2a6bcaa9d4e82c35f6bfb2fdb9016dd9">tl</a>(t,y,deltay,<a class="code" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">buf_kaa</a>)</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a> = y + 0.5*dt*<a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#ae17c25e2843c5f18b69c133ccca1d483">buf_y11</a> = deltay + 0.5*dt*<a class="code" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">buf_kaa</a></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__integrator.html#aa03be9677761cfa373b15c85cccdc424">tendencies</a>(t+0.5*dt,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a>)</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__tensor.html#a2a6bcaa9d4e82c35f6bfb2fdb9016dd9">tl</a>(t+0.5*dt,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#ae17c25e2843c5f18b69c133ccca1d483">buf_y11</a>,<a class="code" href="namespacetl__ad__integrator.html#a68ad95731421a7e0c9f37668631e279c">buf_kbb</a>)</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    </div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a> = y + 0.5*dt*<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#ae17c25e2843c5f18b69c133ccca1d483">buf_y11</a> = deltay + 0.5*dt*<a class="code" href="namespacetl__ad__integrator.html#a68ad95731421a7e0c9f37668631e279c">buf_kbb</a></div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a> = <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a> + 2*<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">buf_kaa</a> = <a class="code" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">buf_kaa</a> + 2*<a class="code" href="namespacetl__ad__integrator.html#a68ad95731421a7e0c9f37668631e279c">buf_kbb</a></div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    </div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__integrator.html#aa03be9677761cfa373b15c85cccdc424">tendencies</a>(t+0.5*dt,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a>)</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__tensor.html#a2a6bcaa9d4e82c35f6bfb2fdb9016dd9">tl</a>(t+0.5*dt,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#ae17c25e2843c5f18b69c133ccca1d483">buf_y11</a>,<a class="code" href="namespacetl__ad__integrator.html#a68ad95731421a7e0c9f37668631e279c">buf_kbb</a>)</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    </div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a> = y + dt*<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#ae17c25e2843c5f18b69c133ccca1d483">buf_y11</a> = deltay + dt*<a class="code" href="namespacetl__ad__integrator.html#a68ad95731421a7e0c9f37668631e279c">buf_kbb</a></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    </div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a> = <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a> + 2*<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">buf_kaa</a> = <a class="code" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">buf_kaa</a> + 2*<a class="code" href="namespacetl__ad__integrator.html#a68ad95731421a7e0c9f37668631e279c">buf_kbb</a></div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    </div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__integrator.html#aa03be9677761cfa373b15c85cccdc424">tendencies</a>(t+dt,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a>)</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__tensor.html#a2a6bcaa9d4e82c35f6bfb2fdb9016dd9">tl</a>(t+dt,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#ae17c25e2843c5f18b69c133ccca1d483">buf_y11</a>,<a class="code" href="namespacetl__ad__integrator.html#a68ad95731421a7e0c9f37668631e279c">buf_kbb</a>)</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a> = <a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a> + <a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">buf_kaa</a> = <a class="code" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">buf_kaa</a> + <a class="code" href="namespacetl__ad__integrator.html#a68ad95731421a7e0c9f37668631e279c">buf_kbb</a></div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    </div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    t=t+dt</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    ynew=y+<a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a>*dt/6</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    deltaynew=deltay+<a class="code" href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">buf_kaa</a>*dt/6</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="keyword">  END SUBROUTINE </span><a class="code" href="namespacetl__ad__integrator.html#a9fb60b4a88b0c5d6ca27b58440a32f74">evolve_tl_step</a></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="comment">  !&gt; Routine to perform a simultaneously an integration step (RK4 algorithm) of the nonlinear and computes the RK4 tangent linear propagator. The boolean variable adjoint allows for an adjoint forward integration. The incremented time is returned.</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">  !&gt; @param y Model variable at time t</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">  !&gt; @param propagator Propagator at time t</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">  !&gt; @param t Actual integration time</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="comment">  !&gt; @param dt Integration timestep</span></div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="comment">  !&gt; @param ynew Model variable at time t+dt</span></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;<span class="comment">  !&gt; @param adjoint If true, compute the propagator of the adjoint model (AD) instead of the tangent one (TL)</span></div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="keyword">  SUBROUTINE </span><a class="code" href="namespacetl__ad__integrator.html#a76538a8bd594899e94228abaa34b48cd">prop_step</a>(y,propagator,t,dt,ynew,adjoint)</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">INTENT(INOUT)</span> :: t</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">INTENT(IN)</span> :: dt</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(0:ndim)</span>, <span class="keywordtype">INTENT(IN)</span> :: y</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordtype">LOGICAL</span>, <span class="keywordtype">INTENT(IN)</span> :: adjoint</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(ndim,ndim)</span>, <span class="keywordtype">INTENT(OUT)</span> :: propagator</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordtype">REAL(KIND=8)</span>, <span class="keywordtype">DIMENSION(0:ndim)</span>, <span class="keywordtype">INTENT(OUT)</span> :: ynew</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160; </div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__integrator.html#aa03be9677761cfa373b15c85cccdc424">tendencies</a>(t,y,<a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a>)</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#abf7d3c46036ca20cca151adc20a2fa14">buf_j1</a>=<a class="code" href="namespacetl__ad__tensor.html#a2782a5116e8bb677b2d5e9637b509cf3">jacobian_mat</a>(y)</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a> = y + 0.5*dt*<a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__integrator.html#aa03be9677761cfa373b15c85cccdc424">tendencies</a>(t+0.5*dt,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a>)</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a0ce53a275fcb35f76e2b34ee8d8df1ca">buf_j2</a>=<a class="code" href="namespacetl__ad__tensor.html#a2782a5116e8bb677b2d5e9637b509cf3">jacobian_mat</a>(<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>)</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    </div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a> = y + 0.5*dt*<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__integrator.html#aa03be9677761cfa373b15c85cccdc424">tendencies</a>(t+0.5*dt,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#a1cf59efa7229b47e580202dfe4bd4fd6">buf_kc</a>)</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#afb500987b643ce33b2a549ba213221fc">buf_j3</a>=<a class="code" href="namespacetl__ad__tensor.html#a2782a5116e8bb677b2d5e9637b509cf3">jacobian_mat</a>(<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>)</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a> = y + dt*<a class="code" href="namespacetl__ad__integrator.html#a1cf59efa7229b47e580202dfe4bd4fd6">buf_kc</a></div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keyword">CALL </span><a class="code" href="namespacetl__ad__integrator.html#aa03be9677761cfa373b15c85cccdc424">tendencies</a>(t+dt,<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>,<a class="code" href="namespacetl__ad__integrator.html#a3b72ebc24a7e0eb44e22e6489ac81ed3">buf_kd</a>)</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a853bee458e7337f1556f19370dcbc9d6">buf_j4</a>=<a class="code" href="namespacetl__ad__tensor.html#a2782a5116e8bb677b2d5e9637b509cf3">jacobian_mat</a>(<a class="code" href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">buf_y1</a>)</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    </div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a4ae89c821542838ecfc5ac3b7a76d5c1">buf_j1h</a>=<a class="code" href="namespacetl__ad__integrator.html#abf7d3c46036ca20cca151adc20a2fa14">buf_j1</a></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a2a5e4cbc6f573f1274e53cbb4607f5bb">buf_j2h</a>=<a class="code" href="namespacetl__ad__integrator.html#a0ce53a275fcb35f76e2b34ee8d8df1ca">buf_j2</a></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a9ead2c02f871be0e94e91278fa71337c">buf_j3h</a>=<a class="code" href="namespacetl__ad__integrator.html#afb500987b643ce33b2a549ba213221fc">buf_j3</a></div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <a class="code" href="namespacetl__ad__integrator.html#a99c2747c1997b622f4ab6170e3a8f23d">buf_j4h</a>=<a class="code" href="namespacetl__ad__integrator.html#a853bee458e7337f1556f19370dcbc9d6">buf_j4</a></div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keyword">call </span>dgemm (<span class="stringliteral">&#39;n&#39;</span>, <span class="stringliteral">&#39;n&#39;</span>, <a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>, <a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>, <a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>, dt/2.0d0, <a class="code" href="namespacetl__ad__integrator.html#a0ce53a275fcb35f76e2b34ee8d8df1ca">buf_j2</a>, <a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>,<a class="code" href="namespacetl__ad__integrator.html#a4ae89c821542838ecfc5ac3b7a76d5c1">buf_j1h</a>, <a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>,1.0d0, <a class="code" href="namespacetl__ad__integrator.html#a2a5e4cbc6f573f1274e53cbb4607f5bb">buf_j2h</a>, <a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>)</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keyword">call </span>dgemm (<span class="stringliteral">&#39;n&#39;</span>, <span class="stringliteral">&#39;n&#39;</span>, <a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>, <a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>, <a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>, dt/2.0d0, <a class="code" href="namespacetl__ad__integrator.html#afb500987b643ce33b2a549ba213221fc">buf_j3</a>, <a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>,<a class="code" href="namespacetl__ad__integrator.html#a2a5e4cbc6f573f1274e53cbb4607f5bb">buf_j2h</a>, <a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>,1.0d0, <a class="code" href="namespacetl__ad__integrator.html#a9ead2c02f871be0e94e91278fa71337c">buf_j3h</a>, <a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>)</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="keyword">call </span>dgemm (<span class="stringliteral">&#39;n&#39;</span>, <span class="stringliteral">&#39;n&#39;</span>, <a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>, <a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>, <a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>, dt      , <a class="code" href="namespacetl__ad__integrator.html#a853bee458e7337f1556f19370dcbc9d6">buf_j4</a>, <a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>,<a class="code" href="namespacetl__ad__integrator.html#a9ead2c02f871be0e94e91278fa71337c">buf_j3h</a>, <a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>,1.0d0, <a class="code" href="namespacetl__ad__integrator.html#a99c2747c1997b622f4ab6170e3a8f23d">buf_j4h</a>, <a class="code" href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">ndim</a>)</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;     </div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    ynew=y  + dt/6.0d0*(<a class="code" href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">buf_ka</a> + 2.0d0*<a class="code" href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">buf_kb</a> + 2.0d0*<a class="code" href="namespacetl__ad__integrator.html#a1cf59efa7229b47e580202dfe4bd4fd6">buf_kc</a> + <a class="code" href="namespacetl__ad__integrator.html#a3b72ebc24a7e0eb44e22e6489ac81ed3">buf_kd</a>)</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">IF</span> (adjoint) <span class="keywordflow">THEN</span></div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            propagator=<a class="code" href="namespacetl__ad__integrator.html#a08f375467a942d0ad466b407a8007a7e">one</a> - dt/6.0d0*(<a class="code" href="namespacetl__ad__integrator.html#a4ae89c821542838ecfc5ac3b7a76d5c1">buf_j1h</a> + 2.0d0*<a class="code" href="namespacetl__ad__integrator.html#a2a5e4cbc6f573f1274e53cbb4607f5bb">buf_j2h</a> + 2.0d0*<a class="code" href="namespacetl__ad__integrator.html#a9ead2c02f871be0e94e91278fa71337c">buf_j3h</a> + <a class="code" href="namespacetl__ad__integrator.html#a99c2747c1997b622f4ab6170e3a8f23d">buf_j4h</a>)</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordflow">ELSE</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            propagator=<a class="code" href="namespacetl__ad__integrator.html#a08f375467a942d0ad466b407a8007a7e">one</a> + dt/6.0d0*(<a class="code" href="namespacetl__ad__integrator.html#a4ae89c821542838ecfc5ac3b7a76d5c1">buf_j1h</a> + 2.0d0*<a class="code" href="namespacetl__ad__integrator.html#a2a5e4cbc6f573f1274e53cbb4607f5bb">buf_j2h</a> + 2.0d0*<a class="code" href="namespacetl__ad__integrator.html#a9ead2c02f871be0e94e91278fa71337c">buf_j3h</a> + <a class="code" href="namespacetl__ad__integrator.html#a99c2747c1997b622f4ab6170e3a8f23d">buf_j4h</a>)</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="keywordflow">    END IF</span>        </div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    t=t+dt</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;   </div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="keyword">  END SUBROUTINE </span><a class="code" href="namespacetl__ad__integrator.html#a76538a8bd594899e94228abaa34b48cd">prop_step</a></div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="keyword">END MODULE </span><a class="code" href="namespacetl__ad__integrator.html">tl_ad_integrator</a></div><div class="ttc" id="namespacetl__ad__tensor_html_a2782a5116e8bb677b2d5e9637b509cf3"><div class="ttname"><a href="namespacetl__ad__tensor.html#a2782a5116e8bb677b2d5e9637b509cf3">tl_ad_tensor::jacobian_mat</a></div><div class="ttdeci">real(kind=8) function, dimension(ndim, ndim), public jacobian_mat(ystar)</div><div class="ttdoc">Compute the Jacobian of MAOOAM in point ystar. </div><div class="ttdef"><b>Definition:</b> <a href="tl__ad__tensor_8f90_source.html#l00084">tl_ad_tensor.f90:84</a></div></div>
<div class="ttc" id="namespaceparams_html_a2323fe1773f086e20c14f266351c482b"><div class="ttname"><a href="namespaceparams.html#a2323fe1773f086e20c14f266351c482b">params::ndim</a></div><div class="ttdeci">integer ndim</div><div class="ttdoc">Number of variables (dimension of the model) </div><div class="ttdef"><b>Definition:</b> <a href="params_8f90_source.html#l00087">params.f90:87</a></div></div>
<div class="ttc" id="namespaceutil_html"><div class="ttname"><a href="namespaceutil.html">util</a></div><div class="ttdoc">Utility module. </div><div class="ttdef"><b>Definition:</b> <a href="util_8f90_source.html#l00013">util.f90:13</a></div></div>
<div class="ttc" id="namespacestat_html"><div class="ttname"><a href="namespacestat.html">stat</a></div><div class="ttdoc">Statistics accumulators. </div><div class="ttdef"><b>Definition:</b> <a href="stat_8f90_source.html#l00014">stat.f90:14</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html"><div class="ttname"><a href="namespacetl__ad__integrator.html">tl_ad_integrator</a></div><div class="ttdoc">Tangent Linear (TL) and Adjoint (AD) model versions of MAOOAM. Integrators module. </div><div class="ttdef"><b>Definition:</b> <a href="rk2__tl__ad__integrator_8f90_source.html#l00022">rk2_tl_ad_integrator.f90:22</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_a9fb60b4a88b0c5d6ca27b58440a32f74"><div class="ttname"><a href="namespacetl__ad__integrator.html#a9fb60b4a88b0c5d6ca27b58440a32f74">tl_ad_integrator::evolve_tl_step</a></div><div class="ttdeci">subroutine, public evolve_tl_step(y, deltay, t, dt, ynew, deltaynew)</div><div class="ttdoc">Routine to perform a simultaneous integration step (RK4 algorithm) of the nonlinear and the tangent l...</div><div class="ttdef"><b>Definition:</b> <a href="rk2__tl__ad__integrator_8f90_source.html#l00165">rk2_tl_ad_integrator.f90:165</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_a708ece5eac01486e65e889d19073fd19"><div class="ttname"><a href="namespacetl__ad__integrator.html#a708ece5eac01486e65e889d19073fd19">tl_ad_integrator::ad_step</a></div><div class="ttdeci">subroutine, public ad_step(y, ystar, t, dt, res)</div><div class="ttdoc">Routine to perform an integration step (Heun algorithm) of the adjoint model. The incremented time is...</div><div class="ttdef"><b>Definition:</b> <a href="rk2__tl__ad__integrator_8f90_source.html#l00092">rk2_tl_ad_integrator.f90:92</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_abf7d3c46036ca20cca151adc20a2fa14"><div class="ttname"><a href="namespacetl__ad__integrator.html#abf7d3c46036ca20cca151adc20a2fa14">tl_ad_integrator::buf_j1</a></div><div class="ttdeci">real(kind=8), dimension(:,:), allocatable buf_j1</div><div class="ttdoc">Buffer to hold jacobians in the RK4 scheme for the tangent linear model. </div><div class="ttdef"><b>Definition:</b> <a href="rk2__tl__ad__integrator_8f90_source.html#l00042">rk2_tl_ad_integrator.f90:42</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_a0ce53a275fcb35f76e2b34ee8d8df1ca"><div class="ttname"><a href="namespacetl__ad__integrator.html#a0ce53a275fcb35f76e2b34ee8d8df1ca">tl_ad_integrator::buf_j2</a></div><div class="ttdeci">real(kind=8), dimension(:,:), allocatable buf_j2</div><div class="ttdoc">Buffer to hold jacobians in the RK4 scheme for the tangent linear model. </div><div class="ttdef"><b>Definition:</b> <a href="rk2__tl__ad__integrator_8f90_source.html#l00043">rk2_tl_ad_integrator.f90:43</a></div></div>
<div class="ttc" id="namespaceaotensor__def_html"><div class="ttname"><a href="namespaceaotensor__def.html">aotensor_def</a></div><div class="ttdoc">The equation tensor for the coupled ocean-atmosphere model with temperature which allows for an exten...</div><div class="ttdef"><b>Definition:</b> <a href="aotensor__def_8f90_source.html#l00021">aotensor_def.f90:21</a></div></div>
<div class="ttc" id="namespacetensor_html_a11054027a386918658f8948231af53b1"><div class="ttname"><a href="namespacetensor.html#a11054027a386918658f8948231af53b1">tensor::sparse_mul3</a></div><div class="ttdeci">subroutine, public sparse_mul3(coolist_ijk, arr_j, arr_k, res)</div><div class="ttdoc">Sparse multiplication of a tensor with two vectors: . </div><div class="ttdef"><b>Definition:</b> <a href="tensor_8f90_source.html#l00100">tensor.f90:100</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_a1cf59efa7229b47e580202dfe4bd4fd6"><div class="ttname"><a href="namespacetl__ad__integrator.html#a1cf59efa7229b47e580202dfe4bd4fd6">tl_ad_integrator::buf_kc</a></div><div class="ttdeci">real(kind=8), dimension(:), allocatable buf_kc</div><div class="ttdoc">Buffer to hold tendencies in the RK4 scheme for the tangent linear model. </div><div class="ttdef"><b>Definition:</b> <a href="rk4__tl__ad__integrator_8f90_source.html#l00038">rk4_tl_ad_integrator.f90:38</a></div></div>
<div class="ttc" id="namespacetensor_html"><div class="ttname"><a href="namespacetensor.html">tensor</a></div><div class="ttdoc">Tensor utility module. </div><div class="ttdef"><b>Definition:</b> <a href="tensor_8f90_source.html#l00013">tensor.f90:13</a></div></div>
<div class="ttc" id="namespacetl__ad__tensor_html_af4683da4f4149b809eb66c3223266ffd"><div class="ttname"><a href="namespacetl__ad__tensor.html#af4683da4f4149b809eb66c3223266ffd">tl_ad_tensor::ad</a></div><div class="ttdeci">subroutine, public ad(t, ystar, deltay, buf)</div><div class="ttdoc">Tendencies for the AD of MAOOAM in point ystar for perturbation deltay. </div><div class="ttdef"><b>Definition:</b> <a href="tl__ad__tensor_8f90_source.html#l00384">tl_ad_tensor.f90:384</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_a68ad95731421a7e0c9f37668631e279c"><div class="ttname"><a href="namespacetl__ad__integrator.html#a68ad95731421a7e0c9f37668631e279c">tl_ad_integrator::buf_kbb</a></div><div class="ttdeci">real(kind=8), dimension(:), allocatable buf_kbb</div><div class="ttdoc">Buffer to hold tendencies in the RK4 scheme for the tangent linear model. </div><div class="ttdef"><b>Definition:</b> <a href="rk4__tl__ad__integrator_8f90_source.html#l00049">rk4_tl_ad_integrator.f90:49</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_a4ae89c821542838ecfc5ac3b7a76d5c1"><div class="ttname"><a href="namespacetl__ad__integrator.html#a4ae89c821542838ecfc5ac3b7a76d5c1">tl_ad_integrator::buf_j1h</a></div><div class="ttdeci">real(kind=8), dimension(:,:), allocatable buf_j1h</div><div class="ttdoc">Buffer to hold jacobians in the RK4 scheme for the tangent linear model. </div><div class="ttdef"><b>Definition:</b> <a href="rk2__tl__ad__integrator_8f90_source.html#l00044">rk2_tl_ad_integrator.f90:44</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_a08f375467a942d0ad466b407a8007a7e"><div class="ttname"><a href="namespacetl__ad__integrator.html#a08f375467a942d0ad466b407a8007a7e">tl_ad_integrator::one</a></div><div class="ttdeci">real(kind=8), dimension(:,:), allocatable one</div><div class="ttdoc">unit matrix </div><div class="ttdef"><b>Definition:</b> <a href="rk2__tl__ad__integrator_8f90_source.html#l00046">rk2_tl_ad_integrator.f90:46</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_a9ead2c02f871be0e94e91278fa71337c"><div class="ttname"><a href="namespacetl__ad__integrator.html#a9ead2c02f871be0e94e91278fa71337c">tl_ad_integrator::buf_j3h</a></div><div class="ttdeci">real(kind=8), dimension(:,:), allocatable buf_j3h</div><div class="ttdoc">Buffer to hold jacobians in the RK4 scheme for the tangent linear model. </div><div class="ttdef"><b>Definition:</b> <a href="rk4__tl__ad__integrator_8f90_source.html#l00046">rk4_tl_ad_integrator.f90:46</a></div></div>
<div class="ttc" id="namespaceutil_html_aca7f2465fedb87fef954d8f0c30668c7"><div class="ttname"><a href="namespaceutil.html#aca7f2465fedb87fef954d8f0c30668c7">util::init_one</a></div><div class="ttdeci">subroutine, public init_one(A)</div><div class="ttdoc">Initialize a square matrix A as a unit matrix. </div><div class="ttdef"><b>Definition:</b> <a href="util_8f90_source.html#l00137">util.f90:137</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_a76538a8bd594899e94228abaa34b48cd"><div class="ttname"><a href="namespacetl__ad__integrator.html#a76538a8bd594899e94228abaa34b48cd">tl_ad_integrator::prop_step</a></div><div class="ttdeci">subroutine, public prop_step(y, propagator, t, dt, ynew, adjoint)</div><div class="ttdoc">Routine to perform a simultaneously an integration step (Heun algorithm) of the nonlinear and compute...</div><div class="ttdef"><b>Definition:</b> <a href="rk2__tl__ad__integrator_8f90_source.html#l00193">rk2_tl_ad_integrator.f90:193</a></div></div>
<div class="ttc" id="namespacetl__ad__tensor_html_a2a6bcaa9d4e82c35f6bfb2fdb9016dd9"><div class="ttname"><a href="namespacetl__ad__tensor.html#a2a6bcaa9d4e82c35f6bfb2fdb9016dd9">tl_ad_tensor::tl</a></div><div class="ttdeci">subroutine, public tl(t, ystar, deltay, buf)</div><div class="ttdoc">Tendencies for the TL of MAOOAM in point ystar for perturbation deltay. </div><div class="ttdef"><b>Definition:</b> <a href="tl__ad__tensor_8f90_source.html#l00396">tl_ad_tensor.f90:396</a></div></div>
<div class="ttc" id="namespaceparams_html"><div class="ttname"><a href="namespaceparams.html">params</a></div><div class="ttdoc">The model parameters module. </div><div class="ttdef"><b>Definition:</b> <a href="params_8f90_source.html#l00018">params.f90:18</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_a853bee458e7337f1556f19370dcbc9d6"><div class="ttname"><a href="namespacetl__ad__integrator.html#a853bee458e7337f1556f19370dcbc9d6">tl_ad_integrator::buf_j4</a></div><div class="ttdeci">real(kind=8), dimension(:,:), allocatable buf_j4</div><div class="ttdoc">Buffer to hold jacobians in the RK4 scheme for the tangent linear model. </div><div class="ttdef"><b>Definition:</b> <a href="rk4__tl__ad__integrator_8f90_source.html#l00043">rk4_tl_ad_integrator.f90:43</a></div></div>
<div class="ttc" id="namespacetl__ad__tensor_html"><div class="ttname"><a href="namespacetl__ad__tensor.html">tl_ad_tensor</a></div><div class="ttdoc">Tangent Linear (TL) and Adjoint (AD) model versions of MAOOAM. Tensors definition module...</div><div class="ttdef"><b>Definition:</b> <a href="tl__ad__tensor_8f90_source.html#l00019">tl_ad_tensor.f90:19</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_afb500987b643ce33b2a549ba213221fc"><div class="ttname"><a href="namespacetl__ad__integrator.html#afb500987b643ce33b2a549ba213221fc">tl_ad_integrator::buf_j3</a></div><div class="ttdeci">real(kind=8), dimension(:,:), allocatable buf_j3</div><div class="ttdoc">Buffer to hold jacobians in the RK4 scheme for the tangent linear model. </div><div class="ttdef"><b>Definition:</b> <a href="rk4__tl__ad__integrator_8f90_source.html#l00042">rk4_tl_ad_integrator.f90:42</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_a54c26282330477995b554805fbacf236"><div class="ttname"><a href="namespacetl__ad__integrator.html#a54c26282330477995b554805fbacf236">tl_ad_integrator::buf_y1</a></div><div class="ttdeci">real(kind=8), dimension(:), allocatable buf_y1</div><div class="ttdoc">Buffer to hold the intermediate position (Heun algorithm) of the tangent linear model. </div><div class="ttdef"><b>Definition:</b> <a href="rk2__tl__ad__integrator_8f90_source.html#l00034">rk2_tl_ad_integrator.f90:34</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_a3b72ebc24a7e0eb44e22e6489ac81ed3"><div class="ttname"><a href="namespacetl__ad__integrator.html#a3b72ebc24a7e0eb44e22e6489ac81ed3">tl_ad_integrator::buf_kd</a></div><div class="ttdeci">real(kind=8), dimension(:), allocatable buf_kd</div><div class="ttdoc">Buffer to hold tendencies in the RK4 scheme for the tangent linear model. </div><div class="ttdef"><b>Definition:</b> <a href="rk4__tl__ad__integrator_8f90_source.html#l00039">rk4_tl_ad_integrator.f90:39</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_aeef5ff45fe5f9b73ceb8d72c195dc381"><div class="ttname"><a href="namespacetl__ad__integrator.html#aeef5ff45fe5f9b73ceb8d72c195dc381">tl_ad_integrator::init_tl_ad_integrator</a></div><div class="ttdeci">subroutine, public init_tl_ad_integrator</div><div class="ttdoc">Routine to initialise the integration buffers. </div><div class="ttdef"><b>Definition:</b> <a href="rk2__tl__ad__integrator_8f90_source.html#l00068">rk2_tl_ad_integrator.f90:68</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_aa03be9677761cfa373b15c85cccdc424"><div class="ttname"><a href="namespacetl__ad__integrator.html#aa03be9677761cfa373b15c85cccdc424">tl_ad_integrator::tendencies</a></div><div class="ttdeci">subroutine tendencies(t, y, res)</div><div class="ttdoc">Routine computing the tendencies of the nonlinear model. </div><div class="ttdef"><b>Definition:</b> <a href="rk2__tl__ad__integrator_8f90_source.html#l00060">rk2_tl_ad_integrator.f90:60</a></div></div>
<div class="ttc" id="namespaceaotensor__def_html_a0dc43bc9294a18f2fe57b67489f1702f"><div class="ttname"><a href="namespaceaotensor__def.html#a0dc43bc9294a18f2fe57b67489f1702f">aotensor_def::aotensor</a></div><div class="ttdeci">type(coolist), dimension(:), allocatable, public aotensor</div><div class="ttdoc"> - Tensor representation of the tendencies. </div><div class="ttdef"><b>Definition:</b> <a href="aotensor__def_8f90_source.html#l00045">aotensor_def.f90:45</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_ae17c25e2843c5f18b69c133ccca1d483"><div class="ttname"><a href="namespacetl__ad__integrator.html#ae17c25e2843c5f18b69c133ccca1d483">tl_ad_integrator::buf_y11</a></div><div class="ttdeci">real(kind=8), dimension(:), allocatable buf_y11</div><div class="ttdoc">Buffer to hold the intermediate position (Heun algorithm) of the tangent linear model. </div><div class="ttdef"><b>Definition:</b> <a href="rk2__tl__ad__integrator_8f90_source.html#l00038">rk2_tl_ad_integrator.f90:38</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_a24b147c589eb6bdb6175c56657aff5ae"><div class="ttname"><a href="namespacetl__ad__integrator.html#a24b147c589eb6bdb6175c56657aff5ae">tl_ad_integrator::buf_kaa</a></div><div class="ttdeci">real(kind=8), dimension(:), allocatable buf_kaa</div><div class="ttdoc">Buffer to hold tendencies in the RK4 scheme for the tangent linear model. </div><div class="ttdef"><b>Definition:</b> <a href="rk4__tl__ad__integrator_8f90_source.html#l00048">rk4_tl_ad_integrator.f90:48</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_a99c2747c1997b622f4ab6170e3a8f23d"><div class="ttname"><a href="namespacetl__ad__integrator.html#a99c2747c1997b622f4ab6170e3a8f23d">tl_ad_integrator::buf_j4h</a></div><div class="ttdeci">real(kind=8), dimension(:,:), allocatable buf_j4h</div><div class="ttdoc">Buffer to hold jacobians in the RK4 scheme for the tangent linear model. </div><div class="ttdef"><b>Definition:</b> <a href="rk4__tl__ad__integrator_8f90_source.html#l00047">rk4_tl_ad_integrator.f90:47</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_a879cc86c1e268775237b6776a4ff7d32"><div class="ttname"><a href="namespacetl__ad__integrator.html#a879cc86c1e268775237b6776a4ff7d32">tl_ad_integrator::buf_ka</a></div><div class="ttdeci">real(kind=8), dimension(:), allocatable buf_ka</div><div class="ttdoc">Buffer to hold tendencies in the RK4 scheme for the tangent linear model. </div><div class="ttdef"><b>Definition:</b> <a href="rk4__tl__ad__integrator_8f90_source.html#l00035">rk4_tl_ad_integrator.f90:35</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_a2a5e4cbc6f573f1274e53cbb4607f5bb"><div class="ttname"><a href="namespacetl__ad__integrator.html#a2a5e4cbc6f573f1274e53cbb4607f5bb">tl_ad_integrator::buf_j2h</a></div><div class="ttdeci">real(kind=8), dimension(:,:), allocatable buf_j2h</div><div class="ttdoc">Buffer to hold jacobians in the RK4 scheme for the tangent linear model. </div><div class="ttdef"><b>Definition:</b> <a href="rk2__tl__ad__integrator_8f90_source.html#l00045">rk2_tl_ad_integrator.f90:45</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_ac88b155557d4fc0bae70007fde3aef06"><div class="ttname"><a href="namespacetl__ad__integrator.html#ac88b155557d4fc0bae70007fde3aef06">tl_ad_integrator::tl_step</a></div><div class="ttdeci">subroutine, public tl_step(y, ystar, t, dt, res)</div><div class="ttdoc">Routine to perform an integration step (Heun algorithm) of the tangent linear model. The incremented time is returned. </div><div class="ttdef"><b>Definition:</b> <a href="rk2__tl__ad__integrator_8f90_source.html#l00145">rk2_tl_ad_integrator.f90:145</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_abd6a1c209bc0120ea4e1e473e067a902"><div class="ttname"><a href="namespacetl__ad__integrator.html#abd6a1c209bc0120ea4e1e473e067a902">tl_ad_integrator::buf_kb</a></div><div class="ttdeci">real(kind=8), dimension(:), allocatable buf_kb</div><div class="ttdoc">Buffer to hold tendencies in the RK4 scheme for the tangent linear model. </div><div class="ttdef"><b>Definition:</b> <a href="rk4__tl__ad__integrator_8f90_source.html#l00036">rk4_tl_ad_integrator.f90:36</a></div></div>
<div class="ttc" id="namespacetl__ad__integrator_html_abc53f72486953af9fa4ced620eee226f"><div class="ttname"><a href="namespacetl__ad__integrator.html#abc53f72486953af9fa4ced620eee226f">tl_ad_integrator::evolve_ad_step</a></div><div class="ttdeci">subroutine, public evolve_ad_step(y, deltay, t, dt, ynew, deltaynew)</div><div class="ttdoc">Routine to perform a simultaneous integration step (RK4 algorithm) of the nonlinear and adjoint toget...</div><div class="ttdef"><b>Definition:</b> <a href="rk2__tl__ad__integrator_8f90_source.html#l00112">rk2_tl_ad_integrator.f90:112</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Feb 19 2018 18:11:22 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
